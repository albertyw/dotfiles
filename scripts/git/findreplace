#!/bin/bash

set -euo pipefail
IFS=$'\n\t'

location=${GIT_PREFIX:-./}

sed2() {
    if [[ $(uname) == Darwin ]]; then
        sed -i '' -e "s/$1/$2/g" "$3"
    else
        sed -i -e "s/$1/$2/g" "$3"
    fi
}

files="$(git ls-files --stage "$location" \
    | grep 100 \
    | cut -f2 \
    | xargs file \
    | awk -F: '/ASCII text/ {print $1    }')"

for file in $files; do
    sed2 "$1" "$2" "$file"
done
