#!/usr/bin/env python

"""
Clone a go repository to its correct location under $GOPATH/src
"""

import os
import subprocess
import sys


def run_command(cmd):
    try:
        subprocess.check_call(cmd)
    except subprocess.CalledProcessError:
        # Git will have printed an error message to stdout/stderr already
        print('asdf')
        pass


if len(sys.argv) < 2:
    print("No repository to goclone")
    sys.exit(1)

# Generate path
repository = sys.argv[1]
repository_temp = repository.replace(":", "/")
repository_temp = repository_temp.split("@")[-1]
rel_path = repository_temp.split("/")

gopath = os.getenv("GOPATH")
if not gopath:
    print("No GOPATH env var found")
    sys.exit(1)
abs_path = os.path.join(gopath, "src", *rel_path)

# Clone
cmd = ["git", "clone", repository, abs_path]
run_command(cmd)

# Add git submodules
os.chdir(abs_path)
cmd = ["git", "submodule", "update", "--init"]
run_command(cmd)
